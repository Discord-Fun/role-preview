function A(){throw new Error("setTimeout has not been defined")}function F(){throw new Error("clearTimeout has not been defined")}var d=A,m=F,v;typeof window!="undefined"?v=window:typeof self!="undefined"?v=self:v={};typeof v.setTimeout=="function"&&(d=setTimeout);typeof v.clearTimeout=="function"&&(m=clearTimeout);function I(e){if(d===setTimeout)return setTimeout(e,0);if((d===A||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(n){return d.call(this,e,0)}}}function ne(e){if(m===clearTimeout)return clearTimeout(e);if((m===F||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(e);try{return m(e)}catch(t){try{return m.call(null,e)}catch(n){return m.call(this,e)}}}var h=[],y=!1,g,E=-1;function re(){!y||!g||(y=!1,g.length?h=g.concat(h):E=-1,h.length&&k())}function k(){if(!y){var e=I(re);y=!0;for(var t=h.length;t;){for(g=h,h=[];++E<t;)g&&g[E].run();E=-1,t=h.length}g=null,y=!1,ne(e)}}function oe(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new B(e,t)),h.length===1&&!y&&I(k)}function B(e,t){this.fun=e,this.array=t}B.prototype.run=function(){this.fun.apply(null,this.array)};var ie="browser",ce="browser",se=!0,ue=[],ae="",fe={},le={},he={};function p(){}var de=p,me=p,ge=p,pe=p,we=p,ve=p,ye=p;function be(e){throw new Error("process.binding is not supported")}function xe(){return"/"}function Te(e){throw new Error("process.chdir is not supported")}function Ee(){return 0}var b=v.performance||{},Se=b.now||b.mozNow||b.msNow||b.oNow||b.webkitNow||function(){return new Date().getTime()};function Pe(e){var t=Se.call(b)*.001,n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n=n-e[0],r=r-e[1],r<0&&(n--,r+=1e9)),[n,r]}var Re=new Date;function Ce(){var e=new Date,t=e-Re;return t/1e3}var $e={nextTick:oe,title:ie,browser:se,env:{NODE_ENV:"production"},argv:ue,version:ae,versions:fe,on:de,addListener:me,once:ge,off:pe,removeListener:we,removeAllListeners:ve,emit:ye,binding:be,cwd:xe,chdir:Te,umask:Ee,hrtime:Pe,platform:ce,release:le,config:he,uptime:Ce},Le=function(e,t,n,r){function c(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function u(s){try{f(r.next(s))}catch(l){o(l)}}function a(s){try{f(r.throw(s))}catch(l){o(l)}}function f(s){s.done?i(s.value):c(s.value).then(u,a)}f((r=r.apply(e,t||[])).next())})},M="application/font-woff",O="image/jpeg",_e={woff:M,woff2:M,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:O,jpeg:O,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"},De=function(){let t=0,n=()=>`0000${(Math.random()*Math.pow(36,4)<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${n()}${t}`)}();function Ue(e){let t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function H(e){let t=Ue(e).toLowerCase();return _e[t]||""}function Ae(e){return t=>new Promise(n=>{setTimeout(()=>{n(t)},e)})}function j(e){return e.search(/^(data:)/)!==-1}function V(e,t){return`data:${t};base64,${e}`}function W(e){return e.split(/,/)[1]}function Fe(e){return new Promise(t=>{let n=window.atob(e.toDataURL().split(",")[1]),r=n.length,c=new Uint8Array(r);for(let i=0;i<r;i+=1)c[i]=n.charCodeAt(i);t(new Blob([c],{type:"image/png"}))})}function Ie(e){return e.toBlob?new Promise(t=>e.toBlob(t)):Fe(e)}function w(e){let t=[];for(let n=0,r=e.length;n<r;n+=1)t.push(e[n]);return t}function S(e,t){let n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace("px",""))}function ke(e){let t=S(e,"border-left-width"),n=S(e,"border-right-width");return e.scrollWidth+t+n}function Be(e){let t=S(e,"border-top-width"),n=S(e,"border-bottom-width");return e.scrollHeight+t+n}function Me(){let e,t;try{t=$e}catch(r){}let n=t&&t.env?t.env.devicePixelRatio:null;return n&&(e=parseInt(n,10),isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}function q(e){return new Promise((t,n)=>{let r=new Image;r.onload=()=>t(r),r.onerror=n,r.crossOrigin="anonymous",r.src=e})}function Oe(e){return Le(this,void 0,void 0,function*(){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)})}function He(e,t){[":before",":after"].forEach(r=>C.clonePseudoElement(e,t,r))}var C;(function(e){function t(i,o,u){let a=window.getComputedStyle(i,u),f=a.getPropertyValue("content");if(f===""||f==="none")return;let s=De();try{o.className=`${o.className} ${s}`}catch(te){return}let l=document.createElement("style");l.appendChild(n(s,u,a)),o.appendChild(l)}e.clonePseudoElement=t;function n(i,o,u){let a=`.${i}:${o}`,f=u.cssText?r(u):c(u);return document.createTextNode(`${a}{${f}}`)}function r(i){let o=i.getPropertyValue("content");return`${i.cssText} content: ${o};`}function c(i){return w(i).map(o=>{let u=i.getPropertyValue(o),a=i.getPropertyPriority(o);return`${o}: ${u}${a?" !important":""};`}).join(" ")}})(C||(C={}));var P=function(e,t,n,r){function c(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function u(s){try{f(r.next(s))}catch(l){o(l)}}function a(s){try{f(r.throw(s))}catch(l){o(l)}}function f(s){s.done?i(s.value):c(s.value).then(u,a)}f((r=r.apply(e,t||[])).next())})};function je(e){return P(this,void 0,void 0,function*(){if(e instanceof HTMLCanvasElement){let t=e.toDataURL();return t==="data:,"?Promise.resolve(e.cloneNode(!1)):q(t)}return Promise.resolve(e.cloneNode(!1))})}function Ve(e,t,n){return P(this,void 0,void 0,function*(){let r=w(e.childNodes);return r.length===0?Promise.resolve(t):r.reduce((c,i)=>c.then(()=>z(i,n)).then(o=>{o&&t.appendChild(o)}),Promise.resolve()).then(()=>t)})}function ze(e,t){return P(this,void 0,void 0,function*(){return t instanceof Element?Promise.resolve().then(()=>We(e,t)).then(()=>He(e,t)).then(()=>qe(e,t)).then(()=>t):t})}function We(e,t){let n=window.getComputedStyle(e),r=t.style;n.cssText?r.cssText=n.cssText:w(n).forEach(c=>{r.setProperty(c,n.getPropertyValue(c),n.getPropertyPriority(c))})}function qe(e,t){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}function z(e,t,n){return P(this,void 0,void 0,function*(){return!n&&t&&!t(e)?Promise.resolve(null):Promise.resolve(e).then(je).then(r=>Ve(e,r,t)).then(r=>ze(e,r))})}var G=3e4,$={};function Ge(e){return/ttf|otf|eot|woff2?/i.test(e)}function X(e,t){let n=e.replace(/\?.*/,"");if(Ge(n)&&(n=n.replace(/.*\//,"")),$[n])return $[n];t.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());let r=o=>{let u="";if(t.imagePlaceholder){let f=t.imagePlaceholder.split(/,/);f&&f[1]&&(u=f[1])}let a=`Failed to fetch resource: ${e}`;return o&&(a=typeof o=="string"?o:o.message),a&&console.error(a),u},i=(window.fetch?window.fetch(e).then(o=>o.blob()).then(o=>new Promise((u,a)=>{let f=new FileReader;f.onloadend=()=>u(f.result),f.onerror=a,f.readAsDataURL(o)})).then(W).catch(()=>new Promise((o,u)=>u())):new Promise((o,u)=>{let a=new XMLHttpRequest,f=()=>{u(new Error(`Timeout of ${G}ms occured while fetching resource: ${e}`))},s=()=>{if(a.readyState!==4)return;if(a.status!==200){u(new Error(`Failed to fetch resource: ${e}, status: ${a.status}`));return}let l=new FileReader;l.onloadend=()=>{o(W(l.result))},l.readAsDataURL(a.response)};a.onreadystatechange=s,a.ontimeout=f,a.responseType="blob",a.timeout=G,a.open("GET",e,!0),a.send()})).catch(r);return $[n]=i,i}var J=/url\((['"]?)([^'"]+?)\1\)/g;function Q(e){return e.search(J)!==-1}function K(e,t,n){return Q(e)?Promise.resolve(e).then(Xe).then(r=>r.reduce((c,i)=>c.then(o=>Je(o,i,t,n)),Promise.resolve(e))):Promise.resolve(e)}function Xe(e){let t=[];return e.replace(J,(n,r,c)=>(t.push(c),n)),t.filter(n=>!j(n))}function Je(e,t,n,r,c){let i=n?Qe(t,n):t;return Promise.resolve(i).then(o=>c?c(o):X(o,r)).then(o=>V(o,H(t))).then(o=>e.replace(Ke(t),`$1${o}$3`)).then(o=>o,()=>i)}function Qe(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;let n=document.implementation.createHTMLDocument(),r=n.createElement("base"),c=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(c),t&&(r.href=t),c.href=e,c.href}function Ke(e){return new RegExp(`(url\\(['"]?)(${Ye(e)})(['"]?\\))`,"g")}function Ye(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}var L=function(e,t,n,r){function c(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function u(s){try{f(r.next(s))}catch(l){o(l)}}function a(s){try{f(r.throw(s))}catch(l){o(l)}}function f(s){s.done?i(s.value):c(s.value).then(u,a)}f((r=r.apply(e,t||[])).next())})};function Y(e,t){return L(this,void 0,void 0,function*(){return e instanceof Element?Promise.resolve(e).then(n=>Ze(n,t)).then(n=>Ne(n,t)).then(n=>et(n,t)):Promise.resolve(e)})}function Ze(e,t){return L(this,void 0,void 0,function*(){let n=e.style.getPropertyValue("background");return n?Promise.resolve(n).then(r=>K(r,null,t)).then(r=>(e.style.setProperty("background",r,e.style.getPropertyPriority("background")),e)):Promise.resolve(e)})}function Ne(e,t){return!(e instanceof HTMLImageElement)||j(e.src)?Promise.resolve(e):Promise.resolve(e.src).then(n=>X(n,t)).then(n=>V(n,H(e.src))).then(n=>new Promise((r,c)=>{e.onload=r,e.onerror=c,e.src=n})).then(()=>e,()=>e)}function et(e,t){return L(this,void 0,void 0,function*(){let r=w(e.childNodes).map(c=>Y(c,t));return Promise.all(r).then(()=>e)})}var R=function(e,t,n,r){function c(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function u(s){try{f(r.next(s))}catch(l){o(l)}}function a(s){try{f(r.throw(s))}catch(l){o(l)}}function f(s){s.done?i(s.value):c(s.value).then(u,a)}f((r=r.apply(e,t||[])).next())})},_={};function rt(e){return R(this,void 0,void 0,function*(){return new Promise((t,n)=>{e.ownerDocument||n(new Error("Provided element is not within a Document")),t(w(e.ownerDocument.styleSheets))}).then(tt).then(nt)})}function ot(e,t){return R(this,void 0,void 0,function*(){return rt(e).then(n=>Promise.all(n.map(r=>{let c=r.parentStyleSheet?r.parentStyleSheet.href:null;return K(r.cssText,c,t)}))).then(n=>n.join(`
`)).then(n=>{let r=document.createElement("style"),c=document.createTextNode(n);return r.appendChild(c),e.firstChild?e.insertBefore(r,e.firstChild):e.appendChild(r),e})})}function tt(e){return R(this,void 0,void 0,function*(){let t=[],n=[];return e.forEach(r=>{if("cssRules"in r)try{w(r.cssRules).forEach(c=>{c.type===CSSRule.IMPORT_RULE&&n.push(N(c.href,r).then(ee).then(i=>{Z(i).forEach(u=>{r.insertRule(u,r.cssRules.length)})}).catch(i=>{console.log("Error loading remote css",i.toString())}))})}catch(c){let i=e.find(o=>o.href===null)||document.styleSheets[0];r.href!=null&&n.push(N(r.href).then(ee).then(o=>{Z(o).forEach(a=>{i.insertRule(a,r.cssRules.length)})}).catch(o=>{console.log("Error loading remote stylesheet",o.toString())})),console.log("Error inlining remote css file",c.toString())}}),Promise.all(n).then(()=>(e.forEach(r=>{if("cssRules"in r)try{w(r.cssRules).forEach(c=>{t.push(c)})}catch(c){console.log(`Error while reading CSS rules from ${r.href}`,c.toString())}}),t))})}function nt(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>Q(t.style.getPropertyValue("src")))}function Z(e){if(e===void 0)return[];let t=e,n=[],r="((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})",c="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",i=new RegExp("(\\/\\*[\\s\\S]*?\\*\\/)","gi");t=t.replace(i,"");let o=new RegExp(r,"gi"),u;for(;u=o.exec(t),u!==null;)n.push(u[0]);t=t.replace(o,"");let a=new RegExp(c,"gi");for(;u=a.exec(t),u!==null;)n.push(u[0]);return n}function N(e,t){if(_[e])return _[e];let n=fetch(e).then(r=>({url:e,cssText:r.text()}),r=>{console.log("ERROR FETCHING CSS: ",r.toString())});return _[e]=n,n}function ee(e){return R(this,void 0,void 0,function*(){return e.cssText.then(t=>{let n=t,r=/url\(["']?([^"')]+)["']?\)/g,i=(n.match(/url\([^)]+\)/g)||[]).map(o=>{let u=o.replace(r,"$1");if(!u.startsWith("https://")){let a=e.url;u=new URL(u,a).href}return new Promise((a,f)=>{fetch(u).then(s=>s.blob()).then(s=>{let l=new FileReader;l.addEventListener("load",te=>{n=n.replace(o,`url(${l.result})`),a([o,l.result])}),l.readAsDataURL(s)}).catch(f)})});return Promise.all(i).then(()=>n)})})}function it(e,t,n){let r="http://www.w3.org/2000/svg",c=document.createElementNS(r,"svg"),i=document.createElementNS(r,"foreignObject");return c.setAttributeNS("","width",`${t}`),c.setAttributeNS("","height",`${n}`),i.setAttributeNS("","width","100%"),i.setAttributeNS("","height","100%"),i.setAttributeNS("","x","0"),i.setAttributeNS("","y","0"),i.setAttributeNS("","externalResourcesRequired","true"),c.appendChild(i),i.appendChild(e),Oe(c)}function ct(e,t){let{style:n}=e;t.backgroundColor&&(n.backgroundColor=t.backgroundColor),t.width&&(n.width=`${t.width}px`),t.height&&(n.height=`${t.height}px`);let r=t.style;return r!=null&&Object.keys(r).forEach(c=>{n[c]=r[c]}),e}var x=function(e,t,n,r){function c(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function u(s){try{f(r.next(s))}catch(l){o(l)}}function a(s){try{f(r.throw(s))}catch(l){o(l)}}function f(s){s.done?i(s.value):c(s.value).then(u,a)}f((r=r.apply(e,t||[])).next())})};function D(e,t={}){let n=t.width||ke(e),r=t.height||Be(e);return{width:n,height:r}}function U(e,t={}){return x(this,void 0,void 0,function*(){let{width:n,height:r}=D(e,t);return z(e,t.filter,!0).then(c=>ot(c,t)).then(c=>Y(c,t)).then(c=>ct(c,t)).then(c=>it(c,n,r))})}var st=U;function T(e,t={}){return x(this,void 0,void 0,function*(){return U(e,t).then(q).then(Ae(100)).then(n=>{let r=document.createElement("canvas"),c=r.getContext("2d"),i=t.pixelRatio||Me(),{width:o,height:u}=D(e,t);return r.width=o*i,r.height=u*i,r.style.width=`${o}`,r.style.height=`${u}`,t.backgroundColor&&(c.fillStyle=t.backgroundColor,c.fillRect(0,0,r.width,r.height)),c.drawImage(n,0,0),r})})}function ut(e,t={}){return x(this,void 0,void 0,function*(){let{width:n,height:r}=D(e,t);return T(e,t).then(c=>c.getContext("2d").getImageData(0,0,n,r).data)})}function at(e,t={}){return x(this,void 0,void 0,function*(){return T(e,t).then(n=>n.toDataURL())})}function ft(e,t={}){return x(this,void 0,void 0,function*(){return T(e,t).then(n=>n.toDataURL("image/jpeg",t.quality||1))})}function lt(e,t={}){return x(this,void 0,void 0,function*(){return T(e,t).then(Ie)})}export{lt as toBlob,T as toCanvas,ft as toJpeg,ut as toPixelData,at as toPng,U as toSvg,st as toSvgDataURL};
